{"version":3,"file":"index.js","sources":["../../src/index.js","../src/index.js"],"sourcesContent":["export class Elemental extends HTMLElement {\n    constructor(props) {\n        super(props);\n        const {shadow, styles, template, proxyRefs} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n        if (isObj(styles) && styles.global && !globalStyleTagCache.get(this.constructor)) {\n            headStyleTag(this.nodeName.toLowerCase())(styles.global);\n            globalStyleTagCache.set(this.constructor, true);\n        }\n        let initial = true, adoptSheets = (cssStrOrObj) => {\n            let {options = {}, css = ''} = isObj(cssStrOrObj) ? cssStrOrObj : {css: cssStrOrObj};\n            this.fallbackCssString = adoptStyles(this, css, {\n                getStringOnFallback: false,//!!this.render,\n                ...options\n            })\n        }, statics = () => {\n            styles && adoptSheets(styles);\n            template && appendTemplate(this, template);\n        };\n\n        Object.assign(this, {\n            unsubs: [],\n            refs: proxyRefs ? refs(proxyRefs)(this) : {},\n            prevState: {},\n            state: {},\n            props: {},\n            prevProps: {},\n            changedProps: [],\n            mounted: new Promise(mount => (this.mount = mount)),\n            initialized: new Promise(mount => (this.init = mount)),\n            update: () => {\n                if (!this.processing) {\n                    this.processing = this.mounted.then(_ => {\n                        this.render && this.renderer && this.renderer(this.render(this.props, this.state, this.setState, this), this.shadowRoot || this);\n                        if (initial) {\n                            this.unmount = this.didMount(...this[GET_ARGS]()) || NOOP;\n                            const logic = this.propLogic && this.propLogic(true);\n                            logic && Object.keys(this.props).forEach(prop => {\n                                logic[prop] && logic[prop](this.props[prop], this.refs);\n                            });\n                        } else {\n                            const shouldUpdate = this.shouldUpdate(...this[GET_ARGS]());\n                            if (shouldUpdate || shouldUpdate === undefined) {\n                                this.didUpdate(...this[GET_ARGS]());\n                                const logic = this.propLogic && this.propLogic();\n                                logic && this.changedProps.forEach(prop =>\n                                    logic[prop] && logic[prop](this.props[prop], this.refs)\n                                )\n                            }\n                        }\n                        initial = false;\n                        this.changedProps = [];\n                        this.processing = false;\n                    })\n                }\n                return this.processing;\n            }\n        });\n\n        shadow && statics();\n        this.initialized.then(() => {\n            !shadow && statics();\n            if (this.observe) {\n                [].concat(this.observe).forEach(o => {\n                    isObj(o) && o.$onChange && this.unsubs.push(o.$onChange(this.update));\n                })\n            }\n            this.beforeInitialUpdate(...this[GET_ARGS]());\n            this.mount();\n        });\n\n        let initAttrs = this.constructor[INIT_ATTRS], length = initAttrs.length;\n        while (length--) initAttrs[length](this);\n        this.update();\n\n    };\n\n    setState = newState => {\n        this.prevState = {...this.state};\n        Object.assign(this.state, newState);\n        this.onStateChange(this.state, this.prevState);\n    };\n\n    [GET_ARGS] = () => [this.props, this.prevProps, this.changedProps];\n\n    emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(\n        new CustomEvent(event, {detail: detail, bubbles: true, composed: true, ...opts})\n    );\n\n    eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n\n    connectedCallback() {\n        if (this[IS_MOUNTED]) return;\n        this[IS_MOUNTED] = true;\n        this.init();\n    }\n\n    attributeChangedCallback(a, o, n) {\n        if (this[IGNORE_ATTR] === a || o === n) return;\n        this[attrToProp(a)] = n;\n    }\n\n    static get observedAttributes() {\n        let {prototype, propTypes} = this;\n        this[INIT_ATTRS] = [];\n        if (!propTypes) return [];\n        return Object.keys(propTypes).map(prop => {\n            let attr = propToAttr(prop);\n            let schema = (propTypes[prop] === 'any' || propTypes[prop].name)\n                ? {type: propTypes[prop]} : propTypes[prop];\n            if (!(prop in prototype)) {\n                Object.defineProperty(prototype, prop, {\n                    get() {\n                        return this.props[prop]\n                    },\n                    set(nextValue) {\n                        let {value, error} = formatType(nextValue, schema.type);\n                        if (error && value != null) console.error(`[${prop}] must be type [${schema.type.name}]`);\n                        if (value === this.props[prop]) return;\n                        this.changedProps.push(prop);\n                        if (schema.reflect) {\n                            this.mounted.then(() => {\n                                this[IGNORE_ATTR] = attr;\n                                updateAttribute(this, attr, schema.type === Boolean && !value ? null : value);\n                                this[IGNORE_ATTR] = false;\n                            });\n                        }\n                        this.prevProps[prop] = this.props[prop];\n                        this.props[prop] = value;\n                        this.update();\n                    }\n                });\n            }\n            schema.value && this[INIT_ATTRS].push(self => (self[prop] = schema.value));\n            return attr;\n        });\n    }\n\n    unsubSubs = () => {\n        let {unsubs: un} = this;\n        for (let i = un.length; i--;) un[i] && un[i]();\n        this.unsubs = [];\n    };\n\n    disconnectedCallback() {\n        let {isConnected, unmount, willUnmount} = this;\n        if (isConnected) return;\n        typeof unmount === 'function' && unmount();\n        willUnmount();\n        this.unsubSubs()\n    }\n\n    onStateChange = () => {\n        return this.update();\n    };\n\n    didUpdate() {\n    }\n\n    didMount() {\n    }\n\n    beforeInitialUpdate() {\n    }\n\n    shouldUpdate() {\n    }\n\n    willUnmount() {\n    }\n}\n\n\nexport const isString = (thing) => typeof thing === 'string';\nexport const isObj = (thing) => Object.prototype.toString.call(thing) === '[object Object]';\nexport const isArray = Array.isArray;\n\nexport const addListener = (to, ev, cb) => to.addEventListener(ev, cb);\nexport const removeListener = (from, ev, cb) => from.removeEventListener(ev, cb);\nexport const eventListener = (to, ev, cb, opts) => {\n    if (!isArray(to)) return addListener(to, ev, cb, opts), () => removeListener(to, ev, cb);\n    let unListenAll = [];\n    to.forEach(l => {\n        addListener(l[0], l[1], l[2], l[3]);\n        unListenAll.push(() => removeListener(l[0], l[1], l[2]));\n    });\n    return () => unListenAll.forEach(f => f());\n};\n\n\nconst IGNORE_ATTR = Symbol(),\n    INIT_ATTRS = Symbol(),\n    IS_MOUNTED = Symbol(),\n    GET_ARGS = Symbol();\n\nlet NOOP = () => {\n};\nexport const isNum = (thing) => !isNaN(parseFloat(thing)) && !isNaN(thing - 0);\nexport const propToAttr = (prop) => prop.replace(/([A-Z])/g, \"-$1\").toLowerCase();\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false || value === 'null' || value === 'false')\n        ? node.removeAttribute(attr)\n        : node.setAttribute(\n        attr,\n        typeof value == \"object\" ? JSON.stringify(value) : value\n        );\n};\nexport const formatType = (value, type) => {\n    if (type === 'any') return {value, error: false};\n    type = type || String;\n    if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n    else if (typeof value == \"string\") {\n        value = type == Number ? Number(value) : type == Object || type == Array ? JSON.parse(value) : value;\n    }\n    if ({}.toString.call(value) == `[object ${type.name}]`) return {\n        value,\n        error: type == Number && Number.isNaN(value)\n    };\n    return {value, error: true};\n};\n\nexport const createElem = tag => document.createElement(tag);\n\nexport const createStyleTag = (css) => {\n    let style = createElem('style');\n    style.appendChild(document.createTextNode(css));\n    return {element: style, update: (css) => style.textContent = css};\n};\n\nexport const getShadowParent = elmnt => {\n    while (elmnt.parentNode && (elmnt = elmnt.parentNode)) if (elmnt instanceof ShadowRoot) return elmnt;\n    return document;\n};\n\nconst constructableStyleCache = new Map();\nconst constructableStyleTagFallbackCache = new Map();\n\nexport const adoptStyles = (element, cssString, options = {}) => {\n    const {async, getStringOnFallback, useStyleTag, noDefaultResets} = options;\n    cssString = (element.shadowRoot && !noDefaultResets ? `:host, *, *::before, *::after {box-sizing: border-box;} ` : '')\n        + (cssString || options.cssString || '');\n    const signature = element.constructor.tag || element.constructor;\n    if (\"adoptedStyleSheets\" in document && !useStyleTag) {\n        let adopter = element.shadowRoot || getShadowParent(element),\n            constructable = constructableStyleCache.get(signature);\n        if (!constructable) {\n            constructable = new CSSStyleSheet();\n            constructable[async ? 'replace' : 'replaceSync'](cssString);\n            constructableStyleCache.set(signature, constructable);\n        }\n        if (!([].concat(adopter.adoptedStyleSheets).includes(constructable))) {\n            adopter.adoptedStyleSheets = [...adopter.adoptedStyleSheets, constructable];\n        }\n    } else {\n        if (getStringOnFallback) return cssString;\n        let style = constructableStyleTagFallbackCache.get(signature);\n        if (!style) {\n            style = createStyleTag(cssString).element;\n            constructableStyleTagFallbackCache.set(signature, style);\n        }\n        (element.shadowRoot || element).appendChild(style.cloneNode(true));\n    }\n};\n\nconst globalStyleTagCache = new Map();\nexport const headStyleTag = (id, mount) => {\n    let style = createElem('style');\n    if (id) style.id = id;\n    style.appendChild(document.createTextNode(\"\"));\n    (mount || document.head).appendChild(style);\n    return (css) => (style.appendChild(document.createTextNode(css)), style);\n};\n\n\nexport const refs = (options) => self => {\n    let {selector = (ref) => `#${ref}`, selectMethod = 'querySelector'} = isObj(options) ? options : {},\n        refsCache = {}, root = self.shadowRoot || self;\n    return new Proxy({}, {\n        get(target, key) {\n            if (key === 'refreshRefsCache') return () => refsCache = {};\n            if (!refsCache[key]) refsCache[key] = root[selectMethod](selector(key));\n            return refsCache[key];\n        }\n    });\n};\n\nconst tagTemplateCache = new Map();\nexport const appendTemplate = (element, templateStr) => {\n    if (!element || !templateStr) return;\n    let el = element.shadowRoot || element,\n        signature = element.constructor,\n        temp = tagTemplateCache.get(signature);\n    if (!temp) {\n        temp = createElem('template');\n        temp.innerHTML = templateStr;\n        tagTemplateCache.set(signature, temp);\n    }\n    el.appendChild(temp.content.cloneNode(true));\n};\n\nlet promise = new Promise(resolve => resolve());\nexport const defer = (fn) => promise.then(fn);\n\nexport const booleanAttr = (ref, attr, bool) => ref[!!bool ? 'setAttribute' : 'removeAttribute'](attr, '');\n\nexport const createTemplate = html => {\n    let temp = createElem('template');\n    temp.innerHTML = html;\n    return temp;\n};\n\nexport const templateToHost = (host, html) => {\n    let temp = createTemplate(html);\n    host.innerHTML = '';\n    host.appendChild(temp.content.cloneNode(true));\n};\n\nexport const TemplateMapFactory = () => {\n    const cache = {};\n    return (id, content) => {\n        if (!cache[id]) {\n            cache[id] = createTemplate(content);\n        }\n        return cache[id].content.cloneNode(true);\n    }\n};\n\n","import {Elemental} from \"../../src\";\n\nconst styles =  // language=CSS format=true\n    jcss`\n        :host {\n            display: block;\n            will-change: opacity, height;\n            width: 100%;\n            transition: all .3s cubic-bezier(0, 0.91, 0.58, 1);\n            height: 0;\n            opacity: 1;\n            overflow: hidden;\n        }\n    `;\n\nconst updateStyle = ({style, props: {expanded, collapsedHeight}, scrollHeight}) =>\n    Object.assign(style, {\n        height: (expanded ? scrollHeight : (collapsedHeight || 0)) + 'px',\n        opacity: (expanded ? 1 : 0)\n    });\n\nexport class Expander extends Elemental {\n    static shadow = true;\n    static styles = styles;\n    static propTypes = {\n        expanded: {\n            type: Boolean,\n            reflect: true\n        },\n        collapsedHeight: Number,\n    };\n\n    didMount() {\n        updateStyle(this);\n    }\n\n    didUpdate() {\n        updateStyle(this);\n    }\n\n    static template = `<slot> </slot>`\n}\n\ncustomElements.define('elemental-expander', Expander);\n\n\nconst container = document.getElementById(\"container\");\n\n/*\n\n    ----------- really simple example made in like 5 min ---------------------\n\n */\ncustomElements.define('elemental-example', class extends Elemental {\n    static proxyRefs = true;\n\n    static styles = /*language=CSS*/ `\n    elemental-example{\n        display: block;\n        width: 100%;\n    }\n     #btn{\n        display:block\n    }\n    elemental-expander{\n        background: aliceblue;\n        width: 50%;\n        margin: 0 auto;\n        text-align: center;\n        font-family: -apple-system, Helvetica;\n    }\n    `;\n\n    didMount() {\n        const {btn, exp} = this.refs;\n\n        btn.onclick = () => {\n            exp.expanded = !exp.expanded;\n        }\n    }\n\n    static template = `\n    <button id=\"btn\">\n        toggle expand\n    </button>\n    \n    <elemental-expander id=\"exp\">\n        <h1>expanded!!!!!</h1>\n    </elemental-expander>\n\n`;\n});\n\n\ncontainer.appendChild(document.createElement('elemental-example'));\n"],"names":["Elemental","HTMLElement","constructor","props","setState","newState","prevState","state","Object","assign","onStateChange","GET_ARGS","prevProps","changedProps","emit","event","detail","opts","from","dispatchEvent","CustomEvent","bubbles","composed","eventListener","to","ev","cb","unsubs","push","unsubSubs","un","i","length","update","shadow","styles","template","proxyRefs","attachShadow","mode","isObj","global","globalStyleTagCache","get","headStyleTag","nodeName","toLowerCase","set","initial","adoptSheets","cssStrOrObj","options","css","fallbackCssString","adoptStyles","getStringOnFallback","statics","appendTemplate","refs","mounted","Promise","mount","initialized","init","processing","then","_","render","renderer","shadowRoot","unmount","didMount","NOOP","logic","propLogic","keys","forEach","prop","shouldUpdate","undefined","didUpdate","observe","concat","o","$onChange","beforeInitialUpdate","initAttrs","INIT_ATTRS","connectedCallback","IS_MOUNTED","attributeChangedCallback","a","n","IGNORE_ATTR","attrToProp","observedAttributes","prototype","propTypes","map","attr","propToAttr","schema","name","type","defineProperty","nextValue","value","error","formatType","console","reflect","updateAttribute","Boolean","self","disconnectedCallback","isConnected","willUnmount","thing","toString","call","isArray","Array","addListener","addEventListener","removeListener","removeEventListener","unListenAll","l","f","Symbol","replace","all","letter","toUpperCase","node","removeAttribute","setAttribute","JSON","stringify","String","includes","Number","parse","isNaN","createElem","tag","document","createElement","createStyleTag","style","appendChild","createTextNode","element","textContent","getShadowParent","elmnt","parentNode","ShadowRoot","constructableStyleCache","Map","constructableStyleTagFallbackCache","cssString","async","useStyleTag","noDefaultResets","signature","adopter","constructable","CSSStyleSheet","adoptedStyleSheets","cloneNode","id","head","selector","ref","selectMethod","refsCache","root","Proxy","target","key","tagTemplateCache","templateStr","el","temp","innerHTML","content","promise","resolve","updateStyle","expanded","collapsedHeight","scrollHeight","height","opacity","Expander","customElements","define","container","getElementById","btn","exp","onclick"],"mappings":"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"}