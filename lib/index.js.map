{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["export class Elemental extends HTMLElement {\n    constructor(props) {\n        super(props);\n        const {shadow, styles, template, proxyRefs} = this.constructor;\n        shadow && this.attachShadow({mode: 'open'});\n        if (isObj(styles) && styles.global && !globalStyleTagCache.get(this.constructor)) {\n            headStyleTag(this.nodeName.toLowerCase())(styles.global);\n            globalStyleTagCache.set(this.constructor, true);\n        }\n        let initial = true, adoptSheets = (cssStrOrObj) => {\n            let {options = {}, css = ''} = isObj(cssStrOrObj) ? cssStrOrObj : {css: cssStrOrObj};\n            this.fallbackCssString = adoptStyles(this, css, {\n                getStringOnFallback: false,//!!this.render,\n                ...options\n            })\n        }, statics = () => {\n            styles && adoptSheets(styles);\n            template && appendTemplate(this, template);\n        };\n\n        Object.assign(this, {\n            unsubs: [],\n            refs: proxyRefs ? refs(proxyRefs)(this) : {},\n            prevState: {},\n            state: {},\n            props: {},\n            prevProps: {},\n            changedProps: [],\n            mounted: new Promise(mount => (this.mount = mount)),\n            initialized: new Promise(mount => (this.init = mount)),\n            update: () => {\n                if (!this.processing) {\n                    this.processing = this.mounted.then(_ => {\n                        this.render && this.renderer && this.renderer(this.render(this.props, this.state, this.setState, this), this.shadowRoot || this);\n                        if (initial) {\n                            this.unmount = this.didMount(...this[GET_ARGS]()) || NOOP;\n                            const logic = this.propLogic && this.propLogic(true);\n                            logic && Object.keys(this.props).forEach(prop => {\n                                logic[prop] && logic[prop](this.props[prop], this.refs);\n                            });\n                        } else {\n                            const shouldUpdate = this.shouldUpdate(...this[GET_ARGS]());\n                            if (shouldUpdate || shouldUpdate === undefined) {\n                                this.didUpdate(...this[GET_ARGS]());\n                                const logic = this.propLogic && this.propLogic();\n                                logic && this.changedProps.forEach(prop =>\n                                    logic[prop] && logic[prop](this.props[prop], this.refs)\n                                )\n                            }\n                        }\n                        initial = false;\n                        this.changedProps = [];\n                        this.processing = false;\n                    })\n                }\n                return this.processing;\n            }\n        });\n\n        shadow && statics();\n        this.initialized.then(() => {\n            !shadow && statics();\n            if (this.observe) {\n                [].concat(this.observe).forEach(o => {\n                    isObj(o) && o.$onChange && this.unsubs.push(o.$onChange(this.update));\n                })\n            }\n            this.beforeInitialUpdate(...this[GET_ARGS]());\n            this.mount();\n        });\n\n        let initAttrs = this.constructor[INIT_ATTRS], length = initAttrs.length;\n        while (length--) initAttrs[length](this);\n        this.update();\n\n    };\n\n    setState = newState => {\n        this.prevState = {...this.state};\n        Object.assign(this.state, newState);\n        this.onStateChange(this.state, this.prevState);\n    };\n\n    [GET_ARGS] = () => [this.props, this.prevProps, this.changedProps];\n\n    emit = (event, detail, opts = {}, from = this) => from.dispatchEvent(\n        new CustomEvent(event, {detail: detail, bubbles: true, composed: true, ...opts})\n    );\n\n    eventListener = (to, ev, cb, opts) => this.unsubs.push(eventListener(to, ev, cb, opts));\n\n    connectedCallback() {\n        if (this[IS_MOUNTED]) return;\n        this[IS_MOUNTED] = true;\n        this.init();\n    }\n\n    attributeChangedCallback(a, o, n) {\n        if (this[IGNORE_ATTR] === a || o === n) return;\n        this[attrToProp(a)] = n;\n    }\n\n    static get observedAttributes() {\n        let {prototype, propTypes} = this;\n        this[INIT_ATTRS] = [];\n        if (!propTypes) return [];\n        return Object.keys(propTypes).map(prop => {\n            let attr = propToAttr(prop);\n            let schema = (propTypes[prop] === 'any' || propTypes[prop].name)\n                ? {type: propTypes[prop]} : propTypes[prop];\n            if (!(prop in prototype)) {\n                Object.defineProperty(prototype, prop, {\n                    get() {\n                        return this.props[prop]\n                    },\n                    set(nextValue) {\n                        let {value, error} = formatType(nextValue, schema.type);\n                        if (error && value != null) console.error(`[${prop}] must be type [${schema.type.name}]`);\n                        if (value === this.props[prop]) return;\n                        this.changedProps.push(prop);\n                        if (schema.reflect) {\n                            this.mounted.then(() => {\n                                this[IGNORE_ATTR] = attr;\n                                updateAttribute(this, attr, schema.type === Boolean && !value ? null : value);\n                                this[IGNORE_ATTR] = false;\n                            });\n                        }\n                        this.prevProps[prop] = this.props[prop];\n                        this.props[prop] = value;\n                        this.update();\n                    }\n                });\n            }\n            schema.value && this[INIT_ATTRS].push(self => (self[prop] = schema.value));\n            return attr;\n        });\n    }\n\n    unsubSubs = () => {\n        let {unsubs: un} = this;\n        for (let i = un.length; i--;) un[i] && un[i]();\n        this.unsubs = [];\n    };\n\n    disconnectedCallback() {\n        let {isConnected, unmount, willUnmount} = this;\n        if (isConnected) return;\n        typeof unmount === 'function' && unmount();\n        willUnmount();\n        this.unsubSubs()\n    }\n\n    onStateChange = () => {\n        return this.update();\n    };\n\n    didUpdate() {\n    }\n\n    didMount() {\n    }\n\n    beforeInitialUpdate() {\n    }\n\n    shouldUpdate() {\n    }\n\n    willUnmount() {\n    }\n}\n\n\nexport const isString = (thing) => typeof thing === 'string';\nexport const isObj = (thing) => Object.prototype.toString.call(thing) === '[object Object]';\nexport const isArray = Array.isArray;\n\nexport const addListener = (to, ev, cb) => to.addEventListener(ev, cb);\nexport const removeListener = (from, ev, cb) => from.removeEventListener(ev, cb);\nexport const eventListener = (to, ev, cb, opts) => {\n    if (!isArray(to)) return addListener(to, ev, cb, opts), () => removeListener(to, ev, cb);\n    let unListenAll = [];\n    to.forEach(l => {\n        addListener(l[0], l[1], l[2], l[3]);\n        unListenAll.push(() => removeListener(l[0], l[1], l[2]));\n    });\n    return () => unListenAll.forEach(f => f());\n};\n\n\nconst IGNORE_ATTR = Symbol(),\n    INIT_ATTRS = Symbol(),\n    IS_MOUNTED = Symbol(),\n    GET_ARGS = Symbol();\n\nlet NOOP = () => {\n};\nexport const isNum = (thing) => !isNaN(parseFloat(thing)) && !isNaN(thing - 0);\nexport const propToAttr = (prop) => prop.replace(/([A-Z])/g, \"-$1\").toLowerCase();\nexport const attrToProp = (attr) => attr.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\nexport const updateAttribute = (node, attr, value) => {\n    (value === null || value === false || value === 'null' || value === 'false')\n        ? node.removeAttribute(attr)\n        : node.setAttribute(\n        attr,\n        typeof value == \"object\" ? JSON.stringify(value) : value\n        );\n};\nexport const formatType = (value, type) => {\n    if (type === 'any') return {value, error: false};\n    type = type || String;\n    if (type == Boolean) value = [true, 1, \"\", \"1\", \"true\"].includes(value);\n    else if (typeof value == \"string\") {\n        value = type == Number ? Number(value) : type == Object || type == Array ? JSON.parse(value) : value;\n    }\n    if ({}.toString.call(value) == `[object ${type.name}]`) return {\n        value,\n        error: type == Number && Number.isNaN(value)\n    };\n    return {value, error: true};\n};\n\nexport const createElem = tag => document.createElement(tag);\n\nexport const createStyleTag = (css) => {\n    let style = createElem('style');\n    style.appendChild(document.createTextNode(css));\n    return {element: style, update: (css) => style.textContent = css};\n};\n\nexport const getShadowParent = elmnt => {\n    while (elmnt.parentNode && (elmnt = elmnt.parentNode)) if (elmnt instanceof ShadowRoot) return elmnt;\n    return document;\n};\n\nconst constructableStyleCache = new Map();\nconst constructableStyleTagFallbackCache = new Map();\n\nexport const adoptStyles = (element, cssString, options = {}) => {\n    const {async, getStringOnFallback, useStyleTag, noDefaultResets} = options;\n    cssString = (element.shadowRoot && !noDefaultResets ? `:host, *, *::before, *::after {box-sizing: border-box;} ` : '')\n        + (cssString || options.cssString || '');\n    const signature = element.constructor.tag || element.constructor;\n    if (\"adoptedStyleSheets\" in document && !useStyleTag) {\n        let adopter = element.shadowRoot || getShadowParent(element),\n            constructable = constructableStyleCache.get(signature);\n        if (!constructable) {\n            constructable = new CSSStyleSheet();\n            constructable[async ? 'replace' : 'replaceSync'](cssString);\n            constructableStyleCache.set(signature, constructable);\n        }\n        if (!([].concat(adopter.adoptedStyleSheets).includes(constructable))) {\n            adopter.adoptedStyleSheets = [...adopter.adoptedStyleSheets, constructable];\n        }\n    } else {\n        if (getStringOnFallback) return cssString;\n        let style = constructableStyleTagFallbackCache.get(signature);\n        if (!style) {\n            style = createStyleTag(cssString).element;\n            constructableStyleTagFallbackCache.set(signature, style);\n        }\n        (element.shadowRoot || element).appendChild(style.cloneNode(true));\n    }\n};\n\nconst globalStyleTagCache = new Map();\nexport const headStyleTag = (id, mount) => {\n    let style = createElem('style');\n    if (id) style.id = id;\n    style.appendChild(document.createTextNode(\"\"));\n    (mount || document.head).appendChild(style);\n    return (css) => (style.appendChild(document.createTextNode(css)), style);\n};\n\n\nexport const refs = (options) => self => {\n    let {selector = (ref) => `#${ref}`, selectMethod = 'querySelector'} = isObj(options) ? options : {},\n        refsCache = {}, root = self.shadowRoot || self;\n    return new Proxy({}, {\n        get(target, key) {\n            if (key === 'refreshRefsCache') return () => refsCache = {};\n            if (!refsCache[key]) refsCache[key] = root[selectMethod](selector(key));\n            return refsCache[key];\n        }\n    });\n};\n\nconst tagTemplateCache = new Map();\nexport const appendTemplate = (element, templateStr) => {\n    if (!element || !templateStr) return;\n    let el = element.shadowRoot || element,\n        signature = element.constructor,\n        temp = tagTemplateCache.get(signature);\n    if (!temp) {\n        temp = createElem('template');\n        temp.innerHTML = templateStr;\n        tagTemplateCache.set(signature, temp);\n    }\n    el.appendChild(temp.content.cloneNode(true));\n};\n\nlet promise = new Promise(resolve => resolve());\nexport const defer = (fn) => promise.then(fn);\n\nexport const booleanAttr = (ref, attr, bool) => ref[!!bool ? 'setAttribute' : 'removeAttribute'](attr, '');\n\nexport const createTemplate = html => {\n    let temp = createElem('template');\n    temp.innerHTML = html;\n    return temp;\n};\n\nexport const templateToHost = (host, html) => {\n    let temp = createTemplate(html);\n    host.innerHTML = '';\n    host.appendChild(temp.content.cloneNode(true));\n};\n\nexport const TemplateMapFactory = () => {\n    const cache = {};\n    return (id, content) => {\n        if (!cache[id]) {\n            cache[id] = createTemplate(content);\n        }\n        return cache[id].content.cloneNode(true);\n    }\n};\n\n"],"names":["Elemental","HTMLElement","constructor","props","super","this","setState","newState","prevState","state","Object","assign","onStateChange","GET_ARGS","prevProps","changedProps","emit","event","detail","opts","from","dispatchEvent","CustomEvent","bubbles","composed","eventListener","to","ev","cb","unsubs","push","unsubSubs","un","i","length","update","shadow","styles","template","proxyRefs","attachShadow","mode","isObj","global","globalStyleTagCache","get","headStyleTag","nodeName","toLowerCase","set","initial","adoptSheets","cssStrOrObj","options","css","fallbackCssString","adoptStyles","getStringOnFallback","statics","appendTemplate","refs","mounted","Promise","mount","initialized","init","processing","then","_","render","renderer","shadowRoot","unmount","didMount","NOOP","logic","propLogic","keys","forEach","prop","shouldUpdate","undefined","didUpdate","observe","concat","o","$onChange","beforeInitialUpdate","initAttrs","INIT_ATTRS","connectedCallback","IS_MOUNTED","attributeChangedCallback","a","n","IGNORE_ATTR","attrToProp","observedAttributes","prototype","propTypes","map","attr","propToAttr","schema","name","type","defineProperty","nextValue","value","error","formatType","console","reflect","updateAttribute","Boolean","self","disconnectedCallback","isConnected","willUnmount","isString","thing","toString","call","isArray","Array","addListener","addEventListener","removeListener","removeEventListener","unListenAll","l","f","Symbol","isNum","isNaN","parseFloat","replace","all","letter","toUpperCase","node","removeAttribute","setAttribute","JSON","stringify","String","includes","Number","parse","createElem","tag","document","createElement","createStyleTag","style","appendChild","createTextNode","element","textContent","getShadowParent","elmnt","parentNode","ShadowRoot","constructableStyleCache","Map","constructableStyleTagFallbackCache","cssString","async","useStyleTag","noDefaultResets","signature","adopter","constructable","CSSStyleSheet","adoptedStyleSheets","cloneNode","id","head","selector","ref","selectMethod","refsCache","root","Proxy","target","key","tagTemplateCache","templateStr","el","temp","innerHTML","content","promise","resolve","defer","fn","booleanAttr","bool","createTemplate","html","templateToHost","host","TemplateMapFactory","cache"],"mappings":"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"}